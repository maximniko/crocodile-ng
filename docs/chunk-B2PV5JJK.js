import{a as T,b as p,c as I,d as D,e as N,f as O,g as V,h as A,i as G,j as L,k as H}from"./chunk-T4AU76N7.js";import{a as x}from"./chunk-M4NZ2IUC.js";import{$ as E,A as f,B as y,G as v,I as u,J as c,O as g,Oa as C,Q as _,Ua as B,Va as R,X as h,_ as b,aa as S,ba as n,ca as o,fa as k,ha as s,ia as P,la as w,qa as m,sa as F}from"./chunk-HNS5UP6F.js";var d=class a{constructor(e){this.el=e;if(!e.nativeElement.focus)throw new Error("Element does not accept focus.")}onEnter(e){this.el.nativeElement.blur()}onTouchEnd(e){this.el.nativeElement.blur()}ngOnInit(){let e=this.el.nativeElement;e.focus(),e.select()}static \u0275fac=function(t){return new(t||a)(c(v))};static \u0275dir=_({type:a,selectors:[["","focusOnShow",""]],hostBindings:function(t,i){t&1&&s("keyup.enter",function(l){return i.onEnter(l)})("touchend",function(l){return i.onTouchEnd(l)})}})};function $(a,e){if(a&1){let t=k();n(0,"div",9)(1,"div",10)(2,"input",11),s("click",function(r){return f(t),y(r.stopPropagation())}),o(),n(3,"label",12),m(4),o()(),n(5,"span",13),s("click",function(){let r=f(t).$index,l=P();return y(l.delete(r))}),m(6,"X"),o()()}if(a&2){let t=e.$index;u(),w("formGroupName",t),u(3),F("Player ",t+1,"")}}var j=class a{constructor(e,t,i,r){this.formBuilder=e;this.playersService=t;this.router=i;this.twa=r;this.startPlayers=this.playersService.players,this.form=this.makeForm(this.startPlayers),this.goBack=this.goBack.bind(this)}form;startPlayers=[];ngOnInit(){this.twa.backButtonOnClick(this.goBack)}ngOnDestroy(){this.twa.offBackButton(this.goBack,!1)}goBack(){this.router.navigate([R.main()])}get players(){return this.form?.controls.players}addPlayer(e){this.players.push(this.playerGroup(e))}delete(e){this.players.removeAt(e)}reset(){this.playersService.savePlayers([]),this.form=this.makeForm([])}onSubmit(){if(this.form.invalid)return;let e=this.form?.get("players")?.value;this.playersService.savePlayers(e),this.goBack()}makeForm(e){return this.formBuilder.group({players:this.formBuilder.array(e?.length?e.map(t=>this.playerGroup(t)):[this.playerGroup()],[this.minLengthArray(2)])})}playerGroup(e){return this.formBuilder.group({name:this.formBuilder.control(e?.name??"",[p.required,p.minLength(2),p.maxLength(16),this.uniqueTitleValidator("name")])})}uniqueTitleValidator(e){return t=>{if(!this.players)return null;let i=[];for(let r=0;r<=this.players.controls.length;r++){let l=this.players.controls[r]?.get(e)?.value;l&&i.push(l.trim().toLowerCase())}if(this.hasDuplicates(i))return{duplicate:!0};for(let r=0;r<=this.players.controls.length;r++)this.players.controls[r]?.get(e)?.setErrors(null);return null}}minLengthArray(e){return t=>t.value.length>=e?null:{minLengthArray:!0}}hasDuplicates(e){return e.length!==new Set(e).size}static \u0275fac=function(t){return new(t||a)(c(L),c(x),c(C),c(B))};static \u0275cmp=g({type:a,selectors:[["ng-component"]],hostAttrs:[1,"d-flex","flex-column","gap-2","pb-5"],decls:16,vars:2,consts:[[1,"text-center","h3","my-3"],[1,"row","row-cols-2","g-2"],[1,"col"],[1,"btn","btn-lg","btn-outline-secondary","w-100",3,"click"],["type","submit",1,"btn","btn-lg","btn-outline-success","w-100",3,"click","disabled"],[1,"col-12"],[1,"btn","btn-lg","btn-outline-primary","w-100",3,"click"],[3,"formGroup"],["formArrayName","players",1,"d-flex","flex-column-reverse"],[1,"input-group","mb-3"],[1,"form-floating",3,"formGroupName"],["focusOnShow","","autocapitalize","none","type","text","id","floatingName","placeholder","Name","formControlName","name",1,"form-control",3,"click"],["for","floatingName"],[1,"input-group-text",3,"click"]],template:function(t,i){t&1&&(n(0,"div",0),m(1,"\u0418\u0433\u0440\u043E\u043A\u0438"),o(),n(2,"div",1)(3,"div",2)(4,"button",3),s("click",function(){return i.reset()}),m(5,"Reset"),o()(),n(6,"div",2)(7,"button",4),s("click",function(){return i.onSubmit()}),m(8,"Save "),o()(),n(9,"div",5)(10,"button",6),s("click",function(){return i.addPlayer()}),m(11,"Add"),o()()(),n(12,"form",7)(13,"div",8),E(14,$,7,2,"div",9,b),o()()),t&2&&(u(7),h("disabled",i.form.invalid),u(5),h("formGroup",i.form),u(2),S(i.players.controls))},dependencies:[H,N,T,I,D,O,G,V,A,d],encapsulation:2})};export{j as PlayersComponent};
