import{a as A,b as u,c as G,d as O,e as V,f as w,g as D,h as B,i as T,j as L,k as R}from"./chunk-RACICZ5R.js";import{a as I}from"./chunk-MDSX475V.js";import{c as k,h as j}from"./chunk-T22ABTVN.js";import{Ca as s,Da as m,Ma as g,Oa as b,Za as f,bb as S,cb as _,db as P,eb as n,fb as l,ga as y,gb as F,ha as h,ib as C,kb as c,lb as E,ob as x,ra as v,ub as a,wb as N}from"./chunk-VBMWY7NM.js";var d=class o{constructor(e){this.el=e;if(!e.nativeElement.focus)throw new Error("Element does not accept focus.")}ngOnInit(){let e=this.el.nativeElement;e.focus(),e.select()}static \u0275fac=function(t){return new(t||o)(m(v))};static \u0275dir=b({type:o,selectors:[["","focusOnShow",""]]})};function q(o,e){if(o&1){let t=C();n(0,"div",4)(1,"div",8),F(2,"input",9),n(3,"label",10),a(4),l()(),n(5,"button",11),c("click",function(){let r=y(t).$index,p=E();return h(p.deleteLesson(r))}),a(6,"X"),l()()}if(o&2){let t=e.$index;s(),x("formGroupName",t),s(3),N("Player ",t+1,"")}}var M=class o{constructor(e,t,i){this.formBuilder=e;this.playersService=t;this.router=i;this.startPlayers=this.playersService.players,this.form=this.makeForm(this.startPlayers)}form;playerSubscription;startPlayers=[];ngOnInit(){this.playerSubscription=this.playersService.playersSubject.subscribe(e=>{e.length!==0&&JSON.stringify(e)!==JSON.stringify(this.startPlayers)&&this.goBack()})}ngOnDestroy(){this.playerSubscription?.unsubscribe()}get players(){return this.form?.controls.players}addPlayer(e){this.players.push(this.playerGroup(e))}deleteLesson(e){this.players.removeAt(e)}reset(){this.playersService.savePlayers([]),this.form=this.makeForm([])}onSubmit(){let e=this.form?.get("players")?.value;this.playersService.savePlayers(e)}makeForm(e){return console.log(this.formBuilder),this.formBuilder.group({players:this.formBuilder.array(e?.length?e.map(t=>this.playerGroup(t)):[this.playerGroup()],[this.minLengthArray(2)])})}playerGroup(e){return this.formBuilder.group({name:this.formBuilder.control(e?.name??"",[u.required,u.minLength(2),u.maxLength(16),this.uniqueTitleValidator("name")])})}uniqueTitleValidator(e){return t=>{if(!this.players)return null;let i=[];for(let r=0;r<=this.players.controls.length;r++){let p=this.players.controls[r]?.get(e)?.value;p&&i.push(p)}if(this.hasDuplicates(i))return{duplicate:!0};for(let r=0;r<=this.players.controls.length;r++)this.players.controls[r]?.get(e)?.setErrors(null);return null}}minLengthArray(e){return t=>t.value.length>=e?null:{minLengthArray:!0}}goBack(){this.router.navigate([j.main()])}hasDuplicates(e){return e.length!==new Set(e).size}static \u0275fac=function(t){return new(t||o)(m(L),m(I),m(k))};static \u0275cmp=g({type:o,selectors:[["ng-component"]],hostAttrs:[1,"d-flex","flex-column","gap-2"],decls:13,vars:2,consts:[[1,"text-center","h3","my-3"],[1,"btn","btn-lg","btn-outline-primary",3,"click"],[3,"formGroup"],["formArrayName","players",1,"d-flex","flex-column-reverse"],[1,"input-group","mb-3"],[1,"d-flex","g-2"],[1,"btn","btn-lg","btn-outline-secondary","w-100",3,"click"],["type","submit",1,"btn","btn-lg","btn-outline-success","w-100",3,"click","disabled"],[1,"form-floating",3,"formGroupName"],["focusOnShow","","type","text","id","floatingName","placeholder","Name","formControlName","name",1,"form-control"],["for","floatingName"],[1,"input-group-text",3,"click"]],template:function(t,i){t&1&&(n(0,"div",0),a(1,"\u0418\u0433\u0440\u043E\u043A\u0438"),l(),n(2,"button",1),c("click",function(){return i.addPlayer()}),a(3,"Add"),l(),n(4,"form",2)(5,"div",3),_(6,q,7,2,"div",4,S),l(),n(8,"div",5)(9,"button",6),c("click",function(){return i.reset()}),a(10,"Reset"),l(),n(11,"button",7),c("click",function(){return i.onSubmit()}),a(12,"Save"),l()()()),t&2&&(s(4),f("formGroup",i.form),s(2),P(i.players.controls),s(5),f("disabled",i.form.invalid))},dependencies:[R,V,A,G,O,w,T,D,B,d],encapsulation:2})};export{M as PlayersComponent};
